{
  "info": {
    "name": "Presence360 Local Dev",
    "description": "Local development collection for Presence360. Set {{control_plane_auth_token}} to the dev super token (e.g., dev-super) and {{tenant_api_auth_token}} to the dev tenant token (e.g., dev-tenant) if auth is enabled.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "control_plane_base_url",
      "value": "http://localhost:8001"
    },
    {
      "key": "tenant_api_base_url",
      "value": "http://localhost:8000"
    },
    {
      "key": "control_plane_auth_token",
      "value": "qX5dEVZdEV-ng7C_CSbuUTsefpoO_O_C"
    },
    {
      "key": "tenant_api_auth_token",
      "value": "qxfwdBdrabVjJmoYTBfdc1OcJGy5x51-"
    },
    {
      "key": "gate_bootstrap_token",
      "value": "VYPbkCc3Z1AEU4ixv8hpyrb5dOrNEAs4"
    },
    {
      "key": "gate_session_token",
      "value": ""
    },
    {
      "key": "gate_id",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "Control Plane",
      "item": [
        {
          "name": "Health check",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{control_plane_base_url}}/healthz"
          },
          "response": [
            {
              "name": "OK",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": "{{control_plane_base_url}}/healthz"
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"status\":\"ok\"}"
            }
          ]
        },
        {
          "name": "Create tenant (grace)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Dev-Admin",
                "value": "1"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{control_plane_auth_token}}"
              },
              {
                "key": "Idempotency-Key",
                "value": "demo-tenant-001"
              }
            ],
            "url": "{{control_plane_base_url}}/v1/tenants",
            "body": {
              "mode": "raw",
              "raw": "{\"slug\":\"grace\",\"name\":\"Grace Chapel\",\"template_key\":\"church\",\"admin_email\":\"admin@grace.local\",\"admin_name\":\"Grace Admin\",\"timezone\":\"Africa/Accra\",\"locale\":\"en-GH\"}"
            }
          },
          "response": [
            {
              "name": "Created",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Dev-Admin",
                    "value": "1"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{control_plane_auth_token}}"
                  },
                  {
                    "key": "Idempotency-Key",
                    "value": "demo-tenant-001"
                  }
                ],
                "url": "{{control_plane_base_url}}/v1/tenants",
                "body": {
                  "mode": "raw",
                  "raw": "{\"slug\":\"grace\",\"name\":\"Grace Chapel\",\"template_key\":\"church\",\"admin_email\":\"admin@grace.local\",\"admin_name\":\"Grace Admin\",\"timezone\":\"Africa/Accra\",\"locale\":\"en-GH\"}"
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"tenant_id\":\"11111111-2222-3333-4444-555555555555\",\"slug\":\"grace\",\"provisioning_state\":\"ready\",\"db_name\":\"tenant_11111111-2222-3333-4444-555555555555\"}"
            }
          ]
        },
        {
          "name": "Create tenant (joy)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Dev-Admin",
                "value": "1"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{control_plane_auth_token}}"
              },
              {
                "key": "Idempotency-Key",
                "value": "demo-tenant-002"
              }
            ],
            "url": "{{control_plane_base_url}}/v1/tenants",
            "body": {
              "mode": "raw",
              "raw": "{\"slug\":\"joy\",\"name\":\"Joy Chapel\",\"template_key\":\"church\",\"admin_email\":\"admin@joy.local\",\"admin_name\":\"Joy Admin\",\"timezone\":\"Africa/Accra\",\"locale\":\"en-GH\"}"
            }
          },
          "response": [
            {
              "name": "Created",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Dev-Admin",
                    "value": "1"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{control_plane_auth_token}}"
                  },
                  {
                    "key": "Idempotency-Key",
                    "value": "demo-tenant-002"
                  }
                ],
                "url": "{{control_plane_base_url}}/v1/tenants",
                "body": {
                  "mode": "raw",
                  "raw": "{\"slug\":\"joy\",\"name\":\"Joy Chapel\",\"template_key\":\"church\",\"admin_email\":\"admin@joy.local\",\"admin_name\":\"Joy Admin\",\"timezone\":\"Africa/Accra\",\"locale\":\"en-GH\"}"
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"tenant_id\":\"66666666-7777-8888-9999-aaaaaaaaaaaa\",\"slug\":\"joy\",\"provisioning_state\":\"ready\",\"db_name\":\"tenant_66666666-7777-8888-9999-aaaaaaaaaaaa\"}"
            }
          ]
        },
        {
          "name": "Idempotency retry example",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Dev-Admin",
                "value": "1"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{control_plane_auth_token}}"
              },
              {
                "key": "Idempotency-Key",
                "value": "demo-tenant-001"
              }
            ],
            "url": "{{control_plane_base_url}}/v1/tenants",
            "body": {
              "mode": "raw",
              "raw": "{\"slug\":\"grace\",\"name\":\"Grace Chapel\",\"template_key\":\"church\",\"admin_email\":\"admin@grace.local\",\"admin_name\":\"Grace Admin\",\"timezone\":\"Africa/Accra\",\"locale\":\"en-GH\"}"
            }
          },
          "response": [
            {
              "name": "Idempotent replay",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Dev-Admin",
                    "value": "1"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{control_plane_auth_token}}"
                  },
                  {
                    "key": "Idempotency-Key",
                    "value": "demo-tenant-001"
                  }
                ],
                "url": "{{control_plane_base_url}}/v1/tenants",
                "body": {
                  "mode": "raw",
                  "raw": "{\"slug\":\"grace\",\"name\":\"Grace Chapel\",\"template_key\":\"church\",\"admin_email\":\"admin@grace.local\",\"admin_name\":\"Grace Admin\",\"timezone\":\"Africa/Accra\",\"locale\":\"en-GH\"}"
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"tenant_id\":\"11111111-2222-3333-4444-555555555555\",\"slug\":\"grace\",\"provisioning_state\":\"ready\",\"db_name\":\"tenant_11111111-2222-3333-4444-555555555555\"}"
            }
          ]
        }
      ]
    },
    {
      "name": "Tenant API",
      "item": [
        {
          "name": "Health check",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{tenant_api_base_url}}/healthz"
          },
          "response": [
            {
              "name": "OK",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": "{{tenant_api_base_url}}/healthz"
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"status\":\"ok\"}"
            }
          ]
        },
        {
          "name": "Tenant info (grace)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-Tenant-Slug",
                "value": "grace"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tenant_api_auth_token}}"
              }
            ],
            "url": "{{tenant_api_base_url}}/v1/tenant-info"
          },
          "response": [
            {
              "name": "OK",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-Tenant-Slug",
                    "value": "grace"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{tenant_api_auth_token}}"
                  }
                ],
                "url": "{{tenant_api_base_url}}/v1/tenant-info"
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"slug\":\"grace\",\"db_name\":\"tenant_11111111-2222-3333-4444-555555555555\"}"
            }
          ]
        },
        {
          "name": "Tenant info (joy)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-Tenant-Slug",
                "value": "joy"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tenant_api_auth_token}}"
              }
            ],
            "url": "{{tenant_api_base_url}}/v1/tenant-info"
          },
          "response": [
            {
              "name": "OK",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-Tenant-Slug",
                    "value": "joy"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{tenant_api_auth_token}}"
                  }
                ],
                "url": "{{tenant_api_base_url}}/v1/tenant-info"
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"slug\":\"joy\",\"db_name\":\"tenant_66666666-7777-8888-9999-aaaaaaaaaaaa\"}"
            }
          ]
        }
      ]
    },
    {
      "name": "Gate Agent",
      "item": [
        {
          "name": "Gate auth session (bootstrap)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-Slug",
                "value": "grace"
              }
            ],
            "url": "{{tenant_api_base_url}}/v1/gate/auth/session",
            "body": {
              "mode": "raw",
              "raw": "{\"gate_id\":\"{{gate_id}}\",\"bootstrap_token\":\"{{gate_bootstrap_token}}\"}"
            }
          },
          "response": [
            {
              "name": "OK",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Tenant-Slug",
                    "value": "grace"
                  }
                ],
                "url": "{{tenant_api_base_url}}/v1/gate/auth/session",
                "body": {
                  "mode": "raw",
                  "raw": "{\"gate_id\":\"{{gate_id}}\",\"bootstrap_token\":\"{{gate_bootstrap_token}}\"}"
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"session_token\":\"gate-session-token\",\"expires_at\":\"2025-01-12T11:00:00+00:00\",\"gate_id\":\"{{gate_id}}\"}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const body = pm.response.json();",
                  "  if (body.session_token) {",
                  "    pm.collectionVariables.set(\"gate_session_token\", body.session_token);",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Gate heartbeat",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-Slug",
                "value": "grace"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gate_session_token}}"
              }
            ],
            "url": "{{tenant_api_base_url}}/v1/gate/heartbeat",
            "body": {
              "mode": "raw",
              "raw": "{\"status\":\"ok\",\"uptime_sec\":123}"
            }
          },
          "response": [
            {
              "name": "Accepted",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Tenant-Slug",
                    "value": "grace"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{gate_session_token}}"
                  }
                ],
                "url": "{{tenant_api_base_url}}/v1/gate/heartbeat",
                "body": {
                  "mode": "raw",
                  "raw": "{\"status\":\"ok\",\"uptime_sec\":123}"
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"accepted\":true,\"details\":{\"status\":\"ok\",\"uptime_sec\":123},\"expires_at\":\"2025-01-12T11:00:00+00:00\"}"
            }
          ]
        },
        {
          "name": "Gate frame upload",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Tenant-Slug",
                "value": "grace"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gate_session_token}}"
              }
            ],
            "url": "{{tenant_api_base_url}}/v1/gate/frames",
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "frame_id",
                  "value": "11111111-2222-3333-4444-555555555555",
                  "type": "text"
                },
                {
                  "key": "gate_id",
                  "value": "{{gate_id}}",
                  "type": "text"
                },
                {
                  "key": "captured_at",
                  "value": "2025-01-12T10:00:00Z",
                  "type": "text"
                },
                {
                  "key": "image",
                  "type": "file",
                  "src": ""
                }
              ]
            }
          },
          "response": [
            {
              "name": "Accepted",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "X-Tenant-Slug",
                    "value": "grace"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{gate_session_token}}"
                  }
                ],
                "url": "{{tenant_api_base_url}}/v1/gate/frames",
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "frame_id",
                      "value": "11111111-2222-3333-4444-555555555555",
                      "type": "text"
                    },
                    {
                      "key": "gate_id",
                      "value": "{{gate_id}}",
                      "type": "text"
                    },
                    {
                      "key": "captured_at",
                      "value": "2025-01-12T10:00:00Z",
                      "type": "text"
                    },
                    {
                      "key": "image",
                      "type": "file",
                      "src": ""
                    }
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\"status\":\"accepted\",\"job_id\":\"job-uuid\"}"
            }
          ]
        }
      ]
    }
  ]
}